<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Outros Documentos</title>
  <style>
    *{box-sizing:border-box}
    html, body { height:100%; }
    body{
      margin:0;font-family:Arial,Helvetica,sans-serif;background:#f1f1f1;
      display:flex;justify-content:center;align-items:center;min-height:100dvh;
    }
    .container{background:#fff;width:100%;max-width:400px;height:100dvh;display:flex;flex-direction:column}

    /* Topbar */
    .topbar{
      background:#333;color:#fff;display:flex;align-items:center;justify-content:space-between;
      padding:10px 12px;font-weight:bold;flex-shrink:0;
    }
    .topbar .title{ text-transform:uppercase; letter-spacing:.5px; }
    .topbar img{ width:22px;height:22px;cursor:pointer; }

    .content{flex:1;overflow-y:auto;padding:8px 16px 16px 16px}

    /* Linhas-editáveis com seta à esquerda */
    .list{ display:flex; flex-direction:column; gap:10px; margin-top:6px; }
    .row{
      display:flex; align-items:center; gap:8px;
      background:#fafafa; border:1px solid #e6e6e6; border-radius:6px;
      padding:10px 12px;
    }
    .row .arrow{
      width:16px; height:16px; flex:0 0 16px; opacity:.65;
    }
    .row input{
      flex:1; border:none; background:transparent; outline:none;
      font-size:14px; color:#2a2a2a; padding:6px 2px;
    }
    .row input::placeholder{ color:#9aa1a4; }

    /* Botão teal */
    .btn{
      width:100%;border:none;border-radius:6px;padding:12px 16px;
      background:#2f6f73;color:#fff;font-weight:bold;letter-spacing:.3px;cursor:pointer;
      margin-top:12px;
    }
    .btn:active{ transform:scale(0.99); }
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <img src="img/back.png" alt="Voltar" id="btnBack">
      <div class="title">Outros Documentos</div>
      <img src="img/check.png" alt="Salvar" id="btnSave">
    </div>

    <div class="content">
      <div class="list">
        <div class="row">
          <img class="arrow" src="img/arrow.png" alt="">
          <input id="docBOT" type="text" placeholder="BOT">
        </div>
        <div class="row">
          <img class="arrow" src="img/arrow.png" alt="">
          <input id="docTTAA" type="text" placeholder="TTAA">
        </div>
        <div class="row">
          <img class="arrow" src="img/arrow.png" alt="">
          <input id="docProc" type="text" placeholder="Nº Processo Judicial">
        </div>
        <div class="row">
          <img class="arrow" src="img/arrow.png" alt="">
          <input id="docExame" type="text" placeholder="Exame clínico ou TPT">
        </div>
      </div>

      <button class="btn" id="btnAuto">AUTO DE INFRAÇÃO</button>
    </div>
  </div>

  <script>
    const K = { docs: 'outros_docs' };
    const $ = id => document.getElementById(id);

    const fields = {
      docBOT:  $('docBOT'),
      docTTAA: $('docTTAA'),
      docProc: $('docProc'),
      docExame:$('docExame'),
    };

    // Mapeia rótulos para montar a lista que o histórico enxerga
    const LABEL = {
      docBOT:  'BOT',
      docTTAA: 'TTAA',
      docProc: 'Nº Processo Judicial',
      docExame:'Exame clínico/TPT'
    };

    function load(){
      try{
        const data = JSON.parse(sessionStorage.getItem(K.docs) || '{}');
        for(const k in fields){ if(data[k]) fields[k].value = data[k]; }
      }catch{}
      // mantém contador correto ao abrir a tela
      syncDocsCounters();
    }

    function snapshot(){
      const data = {};
      for(const k in fields){ data[k] = fields[k].value.trim(); }
      return data;
    }

    // Constrói a "lista" de documentos preenchidos para o histórico
    function buildDocsArray(data){
      const arr = [];
      for(const k in data){
        const v = (data[k]||'').trim();
        if(v){
          arr.push({ id:k, label: LABEL[k] || k, value: v });
        }
      }
      return arr;
    }

    // >>> Sincroniza com historico.html (badges)
    function syncDocsCounters(){
      const data = snapshot();
      const arr  = buildDocsArray(data);
      sessionStorage.setItem('documentosCount', String(arr.length));
      sessionStorage.setItem('outrosDocumentos', JSON.stringify(arr));
    }

    function save(showToast=false){
      const data = snapshot();
      sessionStorage.setItem(K.docs, JSON.stringify(data));
      syncDocsCounters();
      if(showToast) alert('Outros Documentos salvos.');
    }

    // auto-save a cada digitação (e atualiza contadores)
    for(const k in fields){
      fields[k].addEventListener('input', ()=> save(false));
    }

    // ações topo
    $('btnBack').addEventListener('click', ()=>{
      save(false); // garante contador certo
      if(history.length>1) history.back(); else window.location.href='historico.html';
    });
    $('btnSave').addEventListener('click', ()=> save(true));

    // botão principal (mantido como navegação — ajuste se tiver outra página)
    $('btnAuto').addEventListener('click', ()=>{
      save(false);
      // Ex.: window.location.href = 'auto-infracao.html';
      alert('Abrir formulário de Auto de Infração (defina o destino, se houver).');
    });

    load();
  </script>
</body>
</html>
