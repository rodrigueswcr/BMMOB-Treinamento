<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Outros Atendentes</title>
  <style>
    *{box-sizing:border-box}
    html, body { height:100%; }
    body{
      margin:0;font-family:Arial,Helvetica,sans-serif;background:#f1f1f1;
      display:flex;justify-content:center;align-items:center;height:100vh;
    }

    .container{
      background:#fff;width:100%;max-width:400px;height:100%;
      display:flex;flex-direction:column;
    }

    /* Topbar */
    .topbar{
      background:#333;color:#fff;display:flex;align-items:center;justify-content:space-between;
      padding:10px 12px;font-weight:bold;flex-shrink:0;
    }
    .topbar .title{ text-transform:uppercase; letter-spacing:.5px; }
    .topbar img{ width:22px;height:22px;cursor:pointer; }

    .content{flex:1;overflow-y:auto;padding:12px 16px 16px 16px}

    /* Campo RG */
    label{display:block;font-size:12px;color:#2f6f73;margin:8px 0 4px}
    .req::before{content:"* ";color:#d00;font-weight:bold}
    input{
      width:100%;padding:10px 12px;border:1px solid #ccc;border-radius:6px;
      background:#fff;font-size:14px;outline:none
    }
    input:focus{border-color:#888}

    /* Box do nome */
    .rg-match{
      margin-top:6px;padding:10px 12px;border:1px solid #e3e6e8;border-radius:6px;
      background:#f7fafa;color:#243e40;font-size:13px;display:none;
    }
    .rg-match.ok{ display:block; }
    .rg-match.empty{ display:block; background:#fbfbfb;color:#666;border-style:dashed }

    /* Autocomplete */
    .rg-suggest{position:relative;margin-top:6px;}
    .rg-suggest-list{
      position:absolute;top:0;left:0;right:0;z-index:10;
      background:#fff;border:1px solid #e3e6e8;border-radius:6px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      overflow:hidden;display:none;
      max-height:228px;overflow-y:auto;
    }
    .rg-suggest-item{
      padding:10px 12px;font-size:13px;display:flex;justify-content:space-between;gap:10px;
      cursor:pointer;border-bottom:1px solid #f2f4f5;
    }
    .rg-suggest-item:last-child{ border-bottom:none; }
    .rg-suggest-item strong{ color:#2f2f2f; letter-spacing:.2px; }
    .rg-suggest-item span{ color:#667; }
    .rg-suggest-item.active,
    .rg-suggest-item:hover{ background:#f4f9f9; }

    /* Botão */
    .btn-primary{
      margin:16px 0;width:100%;background-color:#2f6f73;color:#fff;border:none;
      border-radius:6px;padding:12px 16px;font-weight:bold;letter-spacing:.3px;cursor:pointer;
    }
    .btn-primary:active{ transform:scale(0.99); }

    /* Lista */
    .rg-list{ display:flex; flex-direction:column; gap:10px; margin:4px 0 10px; }
    .rg-card{
      display:flex; align-items:center; justify-content:space-between;
      background:#f7f7f7; border:1px solid #e3e6e8; border-radius:8px;
      padding:10px 12px; box-shadow:0 1px 0 rgba(0,0,0,.02);
    }
    .rg-title{
      margin:0; font-size:13px; color:#2f2f2f; letter-spacing:.2px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis; padding-right:12px;
      max-width: 260px;
    }
    .rg-actions{ display:flex; gap:8px; }
    .icon-btn{
      width:30px; height:30px; display:flex; align-items:center; justify-content:center;
      background:#fff; border:1px solid #d7dbe0; border-radius:4px; cursor:pointer;
    }
    .icon-btn img{ width:27px; height:27px; display:block; }
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <img src="img/back.png" alt="Voltar" id="btnBack">
      <div class="title">OUTROS ATENDENTES</div>
      <div style="width:22px;height:22px;"></div>
    </div>

    <div class="content">
      <label class="req" for="rg">RG</label>
      <input id="rg" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="" maxlength="14">

      <div id="rgMatch" class="rg-match"></div>

      <div class="rg-suggest" id="rgSuggestWrap" aria-live="polite">
        <div id="rgSuggestList" class="rg-suggest-list" role="listbox" aria-label="Sugestões de RG"></div>
      </div>

      <button class="btn-primary" id="btnAdicionar">ADICIONAR</button>

      <div id="rgList" class="rg-list"></div>
    </div>
  </div>

  <script>
    const DB_RG = [
      { rg: '102345678', nome: 'João Marcelo de Souza' },
      { rg: '112223334', nome: 'Mariana Alves Pereira' },
      { rg: '123456789', nome: 'Carlos Eduardo Martins' },
      { rg: '135791113', nome: 'Bruna Kelly Rocha' },
      { rg: '147258369', nome: 'Ricardo Nunes Barcellos' },
      { rg: '159753486', nome: 'Fernanda Lima Oliveira' },
      { rg: '167890123', nome: 'Paulo Henrique Azevedo' },
      { rg: '176543210', nome: 'Gabriela Santos Teixeira' },
      { rg: '184562739', nome: 'Diego Farias Monteiro' },
      { rg: '192837465', nome: 'Aline Cristina Duarte' },
      { rg: '201345679', nome: 'Thiago Ribeiro Fonseca' },
      { rg: '214365870', nome: 'Patrícia Mendes Carvalho' },
      { rg: '223344556', nome: 'Guilherme Costa Bittencourt' },
      { rg: '234567890', nome: 'Luana Beatriz Ferreira' },
      { rg: '246810121', nome: 'Rafael Augusto Pires' },
      { rg: '257913046', nome: 'Camila Moreira Antunes' },
      { rg: '265432187', nome: 'Sérgio Tadeu Pacheco' },
      { rg: '278945612', nome: 'Beatriz Soares Menezes' },
      { rg: '289176543', nome: 'Vitor Hugo Quadros' },
      { rg: '298765432', nome: 'Letícia Barros Silveira' },
    ];
    const DB_MAP = new Map(DB_RG.map(x => [x.rg, x.nome]));

    function onlyDigits(el){ el.addEventListener('input', e=>{ e.target.value = e.target.value.replace(/\D+/g,''); }); }

    const rgInput   = document.getElementById('rg');
    const rgMatchEl = document.getElementById('rgMatch');
    const btnAdicionar = document.getElementById('btnAdicionar');
    const rgListEl  = document.getElementById('rgList');

    const suggestList = document.getElementById('rgSuggestList');

    const K = { lista: 'outros_atendentes_lista' };
    let activeIndex = -1;

    function getLista(){ try { return JSON.parse(sessionStorage.getItem(K.lista)||'[]'); } catch { return []; } }
    function setLista(arr){ sessionStorage.setItem(K.lista, JSON.stringify(arr)); }

    function atualizarMatch(){
      const valor = rgInput.value.trim();
      const nome = DB_MAP.get(valor);
      rgMatchEl.className = 'rg-match';
      if(!valor){
        rgMatchEl.textContent = '';
        rgMatchEl.style.display = 'none';
        return;
      }
      if(nome){
        rgMatchEl.textContent = `Nome: ${nome}`;
        rgMatchEl.classList.add('ok');
      }else{
        rgMatchEl.textContent = 'RG não encontrado no cadastro.';
        rgMatchEl.classList.add('empty');
      }
    }

    function filtrarRG(query){
      if(!query) return [];
      const q = String(query);
      const starts = DB_RG.filter(x => x.rg.startsWith(q));
      const contains = DB_RG.filter(x => !x.rg.startsWith(q) && x.rg.includes(q));
      return [...starts, ...contains].slice(0, 6);
    }

    function abrirSugestoes(items){
      suggestList.innerHTML = '';
      activeIndex = -1;
      if(!items.length){
        suggestList.style.display = 'none';
        return;
      }
      for(let i=0;i<items.length;i++){
        const it = items[i];
        const li = document.createElement('div');
        li.className = 'rg-suggest-item';
        li.dataset.index = i;
        li.innerHTML = `<strong>${it.rg}</strong><span>${it.nome}</span>`;
        li.addEventListener('mousedown', (ev)=>{
          ev.preventDefault();
          escolherSugestao(i, items);
        });
        suggestList.appendChild(li);
      }
      suggestList.style.display = 'block';
    }

    function fecharSugestoes(){
      suggestList.style.display = 'none';
      activeIndex = -1;
    }

    function escolherSugestao(i, items){
      const sel = items[i];
      if(!sel) return;
      rgInput.value = sel.rg;
      atualizarMatch();
      fecharSugestoes();
      rgInput.focus();
    }

    rgInput.addEventListener('input', ()=>{
      atualizarMatch();
      const items = filtrarRG(rgInput.value.trim());
      abrirSugestoes(items);
    });

    rgInput.addEventListener('keydown', (e)=>{
      if(suggestList.style.display !== 'block') return;
      const items = Array.from(suggestList.querySelectorAll('.rg-suggest-item'));
      if(e.key === 'ArrowDown'){
        e.preventDefault();
        activeIndex = Math.min(activeIndex + 1, items.length - 1);
      }else if(e.key === 'ArrowUp'){
        e.preventDefault();
        activeIndex = Math.max(activeIndex - 1, 0);
      }else if(e.key === 'Enter'){
        if(activeIndex >= 0){
          e.preventDefault();
          const all = filtrarRG(rgInput.value.trim());
          escolherSugestao(activeIndex, all);
        }
      }else if(e.key === 'Escape'){
        fecharSugestoes();
      }
    });

    document.addEventListener('click', (e)=>{
      if(!suggestList.contains(e.target) && e.target !== rgInput){
        fecharSugestoes();
      }
    });

    function renderLista(){
      const arr = getLista();
      rgListEl.innerHTML = '';
      for(const it of arr){
        const card = document.createElement('div');
        card.className = 'rg-card';
        card.dataset.id = it.id;

        const ttl = document.createElement('p');
        ttl.className = 'rg-title';
        const nomeLabel = it.nome || 'Nome não cadastrado';
        ttl.textContent = `${it.rg || '—'} — ${nomeLabel}`;
        card.appendChild(ttl);

        const actions = document.createElement('div');
        actions.className = 'rg-actions';

        // apenas botão excluir
        const bDel = document.createElement('button');
        bDel.className='icon-btn';
        bDel.title='Excluir';
        bDel.innerHTML = '<img src="img/excluir.png" alt="Excluir">';
        bDel.addEventListener('click', ()=>excluirItem(it.id));

        actions.appendChild(bDel);
        card.appendChild(actions);

        rgListEl.appendChild(card);
      }
    }

    function excluirItem(id){
      const arr = getLista().filter(x=>x.id!==id);
      setLista(arr);
      renderLista();
    }

    function validar(){
      if(!rgInput.value.trim()){
        alert('Informe o RG.');
        rgInput.focus();
        return false;
      }
      return true;
    }

    function salvar(){
      if(!validar()) return;
      const arr = getLista();
      const rgLimpo = rgInput.value.replace(/\D+/g,'');
      const nomeDB  = DB_MAP.get(rgLimpo) || null;

      const item = { id: 'oa_' + Date.now(), rg: rgLimpo, nome: nomeDB };
      arr.unshift(item);

      setLista(arr);
      renderLista();
      rgInput.value='';
      atualizarMatch();
      fecharSugestoes();
    }

    btnAdicionar.addEventListener('click', salvar);
    rgInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter' && suggestList.style.display!=='block'){ e.preventDefault(); salvar(); } });
    document.getElementById('btnBack').addEventListener('click', ()=>{
      if(history.length>1) history.back(); else window.location.href='historico.html';
    });

    onlyDigits(rgInput);
    renderLista();
    atualizarMatch();
  </script>
</body>
</html>
