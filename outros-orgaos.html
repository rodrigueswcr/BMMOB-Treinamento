<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Outros Órgãos</title>
  <style>
    *{box-sizing:border-box}
    html, body { height:100%; }
    body{
      margin:0;font-family:Arial,Helvetica,sans-serif;background:#f1f1f1;
      display:flex;justify-content:center;align-items:center;min-height:100dvh;
    }
    .container{background:#fff;width:100%;max-width:400px;height:100dvh;display:flex;flex-direction:column}

    /* Topbar */
    .topbar{
      background:#333;color:#fff;display:flex;align-items:center;justify-content:space-between;
      padding:10px 12px;font-weight:bold;flex-shrink:0;
    }
    .topbar .title{ text-transform:uppercase; letter-spacing:.5px; }
    .topbar img{ width:22px;height:22px;cursor:pointer; }

    .content{flex:1;overflow-y:auto;padding:12px 16px 16px 16px}

    /* Campos iguais ao seu padrão */
    label{display:block;font-size:12px;color:#2f6f73;margin:10px 0 4px}
    .req::before{content:"* ";color:#d00;font-weight:bold}
    input{
      width:100%;padding:12px;border:1px solid #e0e0e0;border-radius:6px;
      background:#fff;font-size:14px;outline:none
    }
    input:focus{border-color:#888}

    /* Botão teal */
    .btn{
      width:100%;border:none;border-radius:6px;padding:12px 16px;margin-top:16px;
      background:#2f6f73;color:#fff;font-weight:bold;letter-spacing:.3px;cursor:pointer;
    }
    .btn:active{ transform:scale(0.99); }
  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <img src="img/back.png" alt="Voltar" id="btnBack">
      <div class="title">Outros Órgãos</div>
      <img src="img/check.png" alt="Salvar" id="btnSave">
    </div>

    <div class="content">
      <label class="req" for="numRegistro">Número Registro</label>
      <input id="numRegistro" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="20" placeholder="">

      <label class="req" for="nomeOrgao">Nome do Órgão</label>
      <input id="nomeOrgao" type="text" maxlength="80" placeholder="">

      <button class="btn" id="btnAdicionar">ADICIONAR</button>
    </div>
  </div>

  <script>
    // Util
    function onlyDigits(el){ el.addEventListener('input', e=>{ e.target.value = e.target.value.replace(/\D+/g,''); }); }

    // Campos
    const numRegistro = document.getElementById('numRegistro');
    const nomeOrgao  = document.getElementById('nomeOrgao');

    // Chaves de storage
    const LIST_KEY  = 'outrosOrgaos';   // lista que o historico.html enxerga
    const COUNT_KEY = 'orgaosCount';    // contador que aparece no badge

    function getLista(){
      try { return JSON.parse(sessionStorage.getItem(LIST_KEY) || '[]'); }
      catch { return []; }
    }

    function setLista(arr){
      sessionStorage.setItem(LIST_KEY, JSON.stringify(arr));
      sessionStorage.setItem(COUNT_KEY, String(arr.length));
    }

    function syncNow(){
      // Garante que o histórico veja algo coerente mesmo se não houver lista criada ainda
      const arr = getLista();
      setLista(arr); // regrava e atualiza COUNT_KEY
    }

    // Navegação (mantida) + ensure sync
    document.getElementById('btnBack').addEventListener('click', ()=>{
      syncNow();
      if(history.length>1) history.back(); else window.location.href='historico.html';
    });
    document.getElementById('btnSave').addEventListener('click', ()=>{
      syncNow();
      alert('Dados salvos.');
    });

    // Validação e adicionar item
    document.getElementById('btnAdicionar').addEventListener('click', ()=>{
      const n = numRegistro.value.trim();
      const o = nomeOrgao.value.trim();
      if(!n){ alert('Informe o Número de Registro.'); numRegistro.focus(); return; }
      if(!o){ alert('Informe o Nome do Órgão.'); nomeOrgao.focus(); return; }

      // Salva na lista da sessão (sem mudar o layout)
      const arr = getLista();
      arr.unshift({
        id: 'org_' + Date.now(),
        registro: n.replace(/\D+/g,''),
        orgao: o
      });
      setLista(arr);  // <-- atualiza também orgaosCount

      alert('Órgão adicionado:\n\nRegistro: ' + n + '\nÓrgão: ' + o);

      // Limpa campos
      numRegistro.value = '';
      nomeOrgao.value = '';
      numRegistro.focus();
    });

    // Init
    onlyDigits(numRegistro);
    syncNow(); // sincroniza contador ao abrir
  </script>
</body>
</html>
